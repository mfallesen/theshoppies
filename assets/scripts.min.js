let movieNominations=[],movieIds=[];const storage=window.localStorage;storage.movieNominations&&(movieNominations=JSON.parse(storage.getItem("movieNominations")||"[]"),window.onload=renderNominations(),document.getElementById("nominationContainer").classList.remove("hidden"));const debounce=(callback,delay)=>{let timeout=null;return(...args)=>{const next=()=>callback(...args);clearTimeout(timeout),timeout=setTimeout(next,delay)}};async function findMovie(event){event.preventDefault(),document.getElementById("nominationContainer").classList.remove("hidden");const resultBox=document.getElementById("movie-results");let movie;resultBox.innerHTML="";const query_url=`https://www.omdbapi.com/?apikey=2afe3024&s=${document.getElementById("searchBox").value}&type=movie`;fetch(query_url).then(response=>response.json()).then(data=>{let options=data.Search;if(null!=options){movieIds=[],movieNominations=JSON.parse(storage.getItem("movieNominations")||"[]"),console.log(movieNominations),document.getElementsByClassName("results")[0].classList.remove("hidden");for(let i=0;i<options.length;i++){const cardId="nominateMovie"+i,title=options[i].Title,year=options[i].Year;let poster=options[i].Poster;const movieDBId=options[i].imdbID;movieIds.push(movieDBId),storage.setItem("movieIds",JSON.stringify(movieIds)),"N/A"===poster&&(poster="./assets/images/picture-not-available-clipart-12.jpg"),console.log(movieDBId);const newCard=`<div class="flex-center card movie-card" data-identifier='${movieDBId}'>\n                                        <h3 id="movieNo">${title}</h2>\n                                        <p id="movieYear">${year}</p>\n                                        <img src="${poster}" alt="${title} poster" id="moviePoster">\n                                        <button id="${cardId}">Nominate me!</button>\n                                    </div>`;resultBox.insertAdjacentHTML("beforeend",newCard);const nominateButton=document.getElementById(`${cardId}`);nominateButton.addEventListener("click",nominate);const comparisonIdentifier=resultBox.lastChild.dataset.identifier;function findNominated(){for(let k=0;k<movieNominations.length;k++)comparisonIdentifier===movieNominations[k].movieID&&(nominateButton.setAttribute("class","disabled"),nominateButton.setAttribute("disabled",""))}findNominated()}}else{const noMovie='<div class="flex-center no-movie ">\n                                    <h2>Sorry we cant seem to find the movie you\'re looking for. Please enjoy this gif of nicholas Cage instead\n                                    </h2>\n                                    <img src="https://www.placecage.com/gif/300/300" alt="Nick Cage Placeholder">\n                                </div>';resultBox.insertAdjacentHTML("beforeend",noMovie)}movieNominations=JSON.parse(storage.getItem("movieNominations")||"[]")}).catch(err=>{console.error("Error: ",err)})}function nominate(){movieNominations=JSON.parse(storage.getItem("movieNominations")||"[]");const nominee=this.parentElement,nomineeTitle=nominee.getElementsByTagName("h3")[0].childNodes[0].data,nomineeYear=nominee.getElementsByTagName("p")[0].childNodes[0].data,nomineePoster=nominee.getElementsByTagName("img")[0].currentSrc,nomineeButtonID=nominee.getElementsByTagName("button")[0].id,nomineeID=nomineeButtonID.charAt(nomineeButtonID.length-1),movieID=movieIds[nomineeID],nomineeCard={title:nomineeTitle,year:nomineeYear,poster:nomineePoster,movieID:movieID};movieNominations.length>4?(document.getElementById("nominationLimitBanner").classList.remove("hidden"),document.getElementById("nominationLimitBanner").scrollIntoView({behavior:"smooth"})):(movieNominations.push(nomineeCard),storage.setItem("movieNominations",JSON.stringify(movieNominations)),renderNominations(),nominee.getElementsByTagName("button")[0].setAttribute("class","disabled"),nominee.getElementsByTagName("button")[0].setAttribute("disabled",""))}function renderNominations(){const nominationCards=document.getElementById("movieNominationCards");nominationCards.innerHTML="";for(let n=0;n<movieNominations.length;n++){const addNomineeCard=`<div class="flex-center nomination-card card">\n            <h2 id="movieNominationNo">${movieNominations[n].title}</h2>\n            <p id="movieNominationNoYear">${movieNominations[n].year}</p>\n            <button id='${movieNominations[n].movieID}'>Remove Nomination</button>\n            </div>`;nominationCards.insertAdjacentHTML("beforeend",addNomineeCard);const nominationEvent=document.getElementById(movieNominations[n].movieID);nominationEvent.addEventListener("click",(function(){console.log("id number: ",movieNominations[n].movieID);const filtered=document.getElementById(movieNominations[n].movieID);console.log(filtered),filtered.id===movieNominations[n].movieID&&movieNominations.splice(n,1);try{const deNominated=document.getElementById(`${movieNominations[n].movieID}`).parentElement;deNominated.parentNode.removeChild(deNominated)}catch(error){console.error(error),error instanceof TypeError&&console.log("TypeError: ",error)}finally{renderNominations(),storage.setItem("movieNominations",JSON.stringify(movieNominations))}}))}}const searchBox=document.getElementById("searchBox"),debouncedHandler=debounce(findMovie,1e3);searchBox.addEventListener("input",debouncedHandler);